pipeline {
    agent any

    parameters {
        choice(name: 'ENV', choices: ['dev', 'staging', 'prod'], description: 'W채hle die Umgebung')
        string(name: 'MESSAGE', defaultValue: '', description: 'Gib eine Nachricht f체r das Deployment an')
    }

    stages {
        stage('Deploy') {
            steps {
                script {
                    def message = params.MESSAGE ? params.MESSAGE : 'Kein Kommentar zum Deployment angegeben.'
                    if (params.ENV == 'prod' && currentBuild.rawBuild.getCause(hudson.model.Cause$UserIdCause) == null) {
                        echo 'Achtung! Deployment auf PROD darf nur manuell erfolgen!'
                        error('Deployment auf PROD abgebrochen.')
                    } else {
                        echo "Deployment in ${params.ENV} l채uft..."
                        echo "Nachricht des Nutzers: ${message}"
                        sh 'exit 1' // Simuliert einen Fehler
                    }
                }
            }
        }
    }
    post {
        always {
            echo 'Pipeline abgeschlossen'
        }
        failure {
            echo "Fehler! Deployment in ${params.ENV} fehlgeschlagen."
            echo "Fehler! Deployment in ${params.ENV} fehlgeschlagen."
        }
        success {
            echo "Deployment erfolgreich f체r ${params.ENV}"
        }
    }
}
